#
# Generates the contents of this repo's GitHub Pages page.
#
# For more details on workflows, see README.md.
#
name: Create Documentation on GitHub Pages

# When to run this workflow
#
# See: https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows
# See: https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#on
#
# TIP: Don't use "schedule" triggers as this will cause the workflow to be disabled after 60 days of inactivity
#   (and afterward the workflow must be manually reenabled).
on:
  # Trigger the workflow on push to the main branch.
  push:
    branches:
      - main
  # Allow manual run of this workflow (https://docs.github.com/en/actions/using-workflows/manually-running-a-workflow)
  workflow_dispatch:

# Permissions for GITHUB_TOKEN for this workflow.
#
# See: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token
permissions:
  # This workflow needs permissions to push changes to the "retype" branch. Thus, it needs "write" permission.
  contents: write

env:
  DOTNET_VERSION: '7.0'

# NOTE: Jobs run in parallel by default.
# https://docs.github.com/en/actions/using-jobs/using-jobs-in-a-workflow
jobs:

  publish:

    # Name of the job
    name: Publish to retype branch

    # Set the type of machine to run on
    # See: https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#jobsjob_idruns-on
    runs-on: ubuntu-latest

    steps:

      ###########################################################################
      #
      # Setup Steps
      #
      ###########################################################################

      # See: https://github.com/marketplace/actions/checkout
      - name: Clone Git repository
        uses: actions/checkout@v4
        with:
          lfs: true
          submodules: false # not needed

      # Setting up .NET speeds up the build process (according to the documentation).
      # See: https://github.com/marketplace/actions/setup-net-core-sdk
      - name: Setup .NET build environment
        uses: actions/setup-dotnet@v4
        with:
          # NOTE: Apparently only the 3rd component can be "x"; i.e. "5.x" is not supported.
          dotnet-version: '${{ env.DOTNET_VERSION }}.x'

      ###########################################################################
      #
      # Build Steps
      #
      ###########################################################################

      # See: https://github.com/retypeapp/action-build
      - name: Build HTML files
        # For pinned versions, see: https://blog.gitguardian.com/github-actions-security-cheat-sheet/#use-specific-action-version-tags
        uses: retypeapp/action-build@21d0112281be2957ea1231796b5b50292cff5ebc # version 2.4.0

      # See: https://github.com/retypeapp/action-github-pages
      - name: Publish HTML files to GitHub Pages
        # For pinned versions, see: https://blog.gitguardian.com/github-actions-security-cheat-sheet/#use-specific-action-version-tags
        uses: retypeapp/action-github-pages@1207708b843b95c1a96b97a09fc4b2e747a1f0de # version 2.3.0
        with:
          # The branch where the results are stored
          branch: retype
          # Update the "retype" branch (instead of creating a new branch)
          update-branch: true
